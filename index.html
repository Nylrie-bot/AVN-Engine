<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Angkringan VN Search</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --primary:#d8a100;
  --bg:#f4f4f4;
  --card:#ffffff;
  --text:#222;
  --muted:#666;
}

body.dark {
  --bg:#121212;
  --card:#1e1e1e;
  --text:#eee;
  --muted:#aaa;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  background:var(--primary);
  color:#fff;
  padding:16px;
  text-align:center;
  font-weight:600;
  position:relative;
}

.toggle{
  position:absolute;
  right:14px;
  top:14px;
  cursor:pointer;
}

.container{padding:16px}

.search-box{
  background:var(--card);
  padding:14px;
  border-radius:14px;
  margin-top:-28px;
  box-shadow:0 6px 14px rgba(0,0,0,.1);
}

input,select{
  width:100%;
  padding:12px;
  margin-top:8px;
  font-size:15px;
  border-radius:10px;
  border:2px solid var(--primary);
  background:transparent;
  color:var(--text);
}

#loader{text-align:center;margin:20px;display:none}

.spinner{
  width:28px;height:28px;
  border:4px solid var(--muted);
  border-top-color:var(--primary);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:auto;
}

@keyframes spin{to{transform:rotate(360deg)}}

.item{
  display:flex;
  gap:12px;
  background:var(--card);
  padding:12px;
  border-radius:14px;
  margin-bottom:14px;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
  cursor:pointer;
}

.thumb{
  width:80px;
  height:110px;
  border-radius:10px;
  background:#ccc center/cover no-repeat;
  flex-shrink:0;
}

.item-title{font-weight:600;margin-bottom:6px}

.preview{font-size:14px;color:var(--muted)}

mark{
  background:#fff1b8;
  padding:0 3px;
  border-radius:4px;
}

/* Bottom sheet */
#sheet{
  position:fixed;
  left:0;right:0;
  bottom:-100%;
  background:var(--card);
  border-radius:18px 18px 0 0;
  padding:18px;
  box-shadow:0 -8px 20px rgba(0,0,0,.3);
  transition:.3s;
  max-height:80%;
  overflow:auto;
}

#sheet.show{bottom:0}

.close{text-align:right;color:var(--muted);cursor:pointer}
</style>
</head>

<body>

<header>
  Angkringan VN Search
  <div class="toggle" onclick="toggleDark()">ðŸŒ™</div>
</header>

<div class="container">
  <div class="search-box">
    <input id="q" placeholder="Cari VN..." oninput="searchVN()">
    <select id="tagFilter" onchange="searchVN()">
      <option value="">Semua Genre</option>
    </select>
  </div>

  <div id="loader"><div class="spinner"></div></div>
  <div id="results"></div>
</div>

<div id="sheet">
  <div class="close" onclick="closeSheet()">Tutup âœ•</div>
  <h3 id="sheetTitle"></h3>
  <p id="sheetContent"></p>
  <a id="sheetLink" target="_blank">Buka halaman VN</a>
</div>

<script>
let posts=[];
let tags=new Set();

function toggleDark(){
  document.body.classList.toggle("dark");
}

function loadFeed(data){
  posts=data.feed.entry||[];
  loader.style.display="none";

  posts.forEach(p=>{
    (p.category||[]).forEach(c=>tags.add(c.term));
  });

  tags.forEach(t=>{
    tagFilter.innerHTML+=`<option>${t}</option>`;
  });

  localStorage.setItem("vn_cache",JSON.stringify(posts));
}

function highlight(t,k){
  return t.replace(new RegExp(`(${k})`,"gi"),"<mark>$1</mark>");
}

function getThumb(p){
  if(p.media$thumbnail)
    return p.media$thumbnail.url.replace("s72-c","s300");
  let m=(p.summary?.$t||"").match(/<img.*?src="(.*?)"/);
  return m?m[1]:"https://via.placeholder.com/300x420?text=No+Image";
}

function searchVN(){
  let k=q.value.toLowerCase();
  let tag=tagFilter.value;
  results.innerHTML="";
  if(!k)return;

  posts.forEach(p=>{
    let title=p.title.$t;
    let sum=p.summary?.$t||"";
    let cats=(p.category||[]).map(c=>c.term);

    if((title+sum).toLowerCase().includes(k) &&
       (!tag||cats.includes(tag))){
      results.innerHTML+=`
      <div class="item" onclick="openSheet('${encodeURIComponent(title)}','${encodeURIComponent(sum)}','${p.link.find(l=>l.rel==='alternate').href}')">
        <div class="thumb" style="background-image:url('${getThumb(p)}')"></div>
        <div>
          <div class="item-title">${highlight(title,k)}</div>
          <div class="preview">${highlight(sum.slice(0,100),k)}...</div>
        </div>
      </div>`;
    }
  });
}

function openSheet(t,c,l){
  sheetTitle.innerText=decodeURIComponent(t);
  sheetContent.innerText=decodeURIComponent(c);
  sheetLink.href=l;
  sheet.classList.add("show");
}

function closeSheet(){sheet.classList.remove("show")}

loader.style.display="block";

/* Offline cache */
let cache=localStorage.getItem("vn_cache");
if(cache){
  posts=JSON.parse(cache);
  loader.style.display="none";
}
</script>

<script src="https://angkringanvisualnovel.blogspot.com/feeds/posts/default?alt=json&max-results=150&callback=loadFeed"></script>

</body>
</html>

