<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>VN Search</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,sans-serif;background:#f4f4f4;color:#222;}
#splash{position:fixed;inset:0;background:#ffcc33;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:bold;z-index:999;}
.header{background:#ffcc33;padding:14px;text-align:center;font-weight:bold;font-size:18px;}
.tab-bar{display:flex;}
.tab-bar div{flex:1;text-align:center;padding:10px;cursor:pointer;background:#fff;border-bottom:2px solid #ddd;}
.tab-bar .active{border-bottom:2px solid #ffcc33;font-weight:bold;}
.container{padding:15px;padding-bottom:60px;display:none;}
input,select{width:100%;padding:12px;margin-bottom:10px;border-radius:12px;border:1px solid #ccc;}
.item{display:flex;gap:12px;background:#fff;padding:12px;border-radius:16px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.1);cursor:pointer;}
.thumb{width:70px;height:95px;border-radius:10px;background-size:cover;background-position:center;}
.item-title{font-weight:bold}
.preview{font-size:13px;opacity:.8}
.genre{font-size:12px;opacity:.6}
.fav{font-size:18px;float:right;cursor:pointer;}
#empty{text-align:center;opacity:.6;margin-top:30px;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;}
.overlay.show{display:block}
.sheet{position:fixed;left:0;right:0;bottom:-100%;background:#fff;border-radius:20px 20px 0 0;padding:10px;transition:.3s;max-height:90%;}
.sheet.show{bottom:0;}
.sheet a{display:none;}
.sheet iframe{width:100%;height:70vh;border:none;border-radius:12px;}
</style>
</head>
<body>

<div id="splash">VN Search</div>
<div class="header">Visual Novel Search</div>

<div class="tab-bar">
  <div id="tab-search" class="active" onclick="showTab('search')">Search</div>
  <div id="tab-fav" onclick="showTab('fav')">Favorites</div>
</div>

<div id="page-search" class="container" style="display:block">
  <input id="q" placeholder="Cari judul, genre, kata kunci..." oninput="searchVN()">
  <select id="tagFilter" onchange="searchVN()">
    <option value="">Semua Genre</option>
  </select>
  <div id="results"></div>
  <div id="empty" style="display:none">Tidak ada hasil</div>
</div>

<div id="page-fav" class="container">
  <div id="favResults"></div>
  <div id="emptyFav" style="display:none">Belum ada VN favorit</div>
</div>

<div class="overlay" onclick="closeSheet()"></div>

<div class="sheet" id="sheet">
  <h3 id="sheetTitle"></h3>
  <div id="sheetGenre" class="genre"></div>
  <p id="sheetSum"></p>
  <span class="fav" onclick="toggleFav()">‚ù§Ô∏è</span>
  <iframe id="sheetFrame"></iframe>
</div>

<script>
let posts=[], currentLink="", currentTitle="", currentSum="", currentCats=[];
let favs=JSON.parse(localStorage.getItem("favs")||"[]");

function loadFeed(d){
  posts=d.feed.entry||[];
  loadTags();
  document.getElementById("splash").remove();
}

function loadTags(){
  const set=new Set();
  posts.forEach(p=>(p.category||[]).forEach(c=>set.add(c.term)));
  tagFilter.innerHTML='<option value="">Semua Genre</option>';
  [...set].sort().forEach(t=>tagFilter.innerHTML+=`<option>${t}</option>`);
}

function getThumb(p){return p.media$thumbnail?.url||p.content?.$t.match(/img[^>]+src="([^"]+)"/)?.[1]||"https://via.placeholder.com/150";}

function searchVN(){
  const key=q.value.toLowerCase(), tag=tagFilter.value.toLowerCase();
  results.innerHTML="";let found=0;
  posts.forEach(p=>{
    const title=p.title.$t, sum=p.summary?.$t||"", cats=(p.category||[]).map(x=>x.term);
    const text=(title+sum+cats.join(" ")).toLowerCase();
    if((!key||text.includes(key)) && (!tag||cats.map(c=>c.toLowerCase()).includes(tag))){
      found++;
      const link=p.link.find(l=>l.rel==="alternate").href;
      results.innerHTML+=`<div class="item" onclick='openSheet(${JSON.stringify(title)},${JSON.stringify(sum)},${JSON.stringify(cats)},"${link}")'>
      <div class="thumb" style="background-image:url('${getThumb(p)}')"></div>
      <div>
      <div class="item-title">${title}</div>
      <div class="preview">${sum.slice(0,90)}...</div>
      <div class="genre">${cats.join(", ")}</div>
      </div></div>`;
    }
  });
  document.getElementById("empty").style.display=found?"none":"block";
}

function showTab(t){
  document.getElementById("page-search").style.display=t==="search"?"block":"none";
  document.getElementById("page-fav").style.display=t==="fav"?"block":"none";
  document.getElementById("tab-search").classList.toggle("active", t==="search");
  document.getElementById("tab-fav").classList.toggle("active", t==="fav");
  if(t==="fav") renderFav();
}

function renderFav(){
  const container=favResults;
  container.innerHTML="";
  if(favs.length===0){emptyFav.style.display="block";return;}else{emptyFav.style.display="none";}
  favs.forEach(link=>{
    const p=posts.find(x=>x.link.find(l=>l.rel==="alternate").href===link);
    if(p){
      container.innerHTML+=`<div class="item" onclick='openSheet(${JSON.stringify(p.title.$t)},${JSON.stringify(p.summary?.$t||"")},${JSON.stringify((p.category||[]).map(x=>x.term))},"${link}")'>
      <div class="thumb" style="background-image:url('${getThumb(p)}')"></div>
      <div><div class="item-title">${p.title.$t}</div>
      <div class="preview">${(p.summary?.$t||"").slice(0,90)}...</div>
      <div class="genre">${(p.category||[]).map(x=>x.term).join(", ")}</div></div></div>`;
    }
  });
}

function openSheet(t,s,c,l){
  currentTitle=t;currentSum=s;currentCats=c;currentLink=l;
  sheetTitle.innerText=t;sheetSum.innerText=s;sheetGenre.innerText=c.join(", ");
  sheetFrame.src=l;
  updateFavIcon();
  sheet.classList.add("show");
  document.querySelector(".overlay").classList.add("show");
}

function closeSheet(){sheet.classList.remove("show");document.querySelector(".overlay").classList.remove("show");}

function toggleFav(){
  if(favs.includes(currentLink)) favs=favs.filter(x=>x!==currentLink);
  else favs.push(currentLink);
  localStorage.setItem("favs",JSON.stringify(favs));
  updateFavIcon();
}

function updateFavIcon(){document.querySelector(".fav").innerText=favs.includes(currentLink)?"‚ù§Ô∏è":"ü§ç";}
</script>

<script src="https://angkringanvisualnovel.blogspot.com/feeds/posts/default?alt=json&callback=loadFeed"></script>

</body>
</html>
