<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>VN Search Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,sans-serif;}
body{background:#f4f4f4;color:#222;transition:background 0.3s,color 0.3s;}
body.dark{background:#121212;color:#eee;}
/* SPLASH */
#splash{position:fixed;inset:0;background:#ffcc33;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:bold;z-index:999;}
/* HEADER + DARK MODE */
.header{background:#ffcc33;padding:14px;text-align:center;font-weight:bold;font-size:18px;display:flex;align-items:center;justify-content:space-between;}
.toggle-dark{cursor:pointer;font-size:18px;}
/* TAB BAR */
.tab-bar{display:flex;}
.tab-bar div{flex:1;text-align:center;padding:10px;cursor:pointer;background:#fff;border-bottom:2px solid #ddd;}
.tab-bar .active{border-bottom:2px solid #ffcc33;font-weight:bold;}
/* CONTAINER */
.container{padding:15px;padding-bottom:60px;display:none;}
input,select{width:100%;padding:12px;margin-bottom:10px;border-radius:12px;border:1px solid #ccc;transition:background 0.3s,color 0.3s;}
body.dark input,body.dark select{background:#1f1f1f;color:#eee;border-color:#444;}
/* CARD */
.item{display:flex;gap:12px;background:#fff;padding:12px;border-radius:16px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.1);cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;}
body.dark .item{background:#1f1f1f;}
.item:hover{transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,.2);}
.thumb{width:70px;height:95px;border-radius:10px;background-size:cover;background-position:center;}
.item-title{font-weight:bold;margin-bottom:4px;}
.preview{font-size:13px;opacity:.8;margin-bottom:4px;}
.genre{font-size:12px;opacity:.6;margin-bottom:4px;}
.fav{font-size:18px;float:right;cursor:pointer;user-select:none;}
.highlight{background:yellow;color:#000;}
/* EMPTY */
#empty,#emptyFav,#emptyHome{text-align:center;opacity:.6;margin-top:30px;}
/* OVERLAY + SHEET */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;z-index:998;}
.overlay.show{display:block;}
.sheet{position:fixed;left:0;right:0;bottom:-100%;background:#fff;border-radius:20px 20px 0 0;padding:10px;transition:.3s;max-height:90%;overflow:auto;z-index:999;}
body.dark .sheet{background:#1f1f1f;color:#eee;}
.sheet.show{bottom:0;}
.sheet iframe{width:100%;height:70vh;border:none;border-radius:12px;}
</style>
</head>
<body>

<div id="splash">VN Search Pro</div>

<div class="header">
  <div>Visual Novel</div>
  <div class="toggle-dark" onclick="toggleDark()">üåô</div>
</div>

<div class="tab-bar">
  <div id="tab-home" class="active" onclick="showTab('home')">Home</div>
  <div id="tab-search" onclick="showTab('search')">Search</div>
  <div id="tab-fav" onclick="showTab('fav')">Favorites</div>
  <div id="tab-about" onclick="showTab('about')">About</div>
</div>

<!-- HOME -->
<div id="page-home" class="container" style="display:block">
  <div id="homeResults"></div>
  <div id="emptyHome" style="display:none">Belum ada rekomendasi</div>
</div>

<!-- SEARCH -->
<div id="page-search" class="container">
  <input id="q" placeholder="Cari judul, genre, kata kunci..." oninput="searchVN()">
  <select id="tagFilter" onchange="searchVN()"><option value="">Semua Genre</option></select>
  <div id="results"></div>
  <div id="empty" style="display:none">Tidak ada hasil</div>
</div>

<!-- FAVORITES -->
<div id="page-fav" class="container">
  <div id="favResults"></div>
  <div id="emptyFav" style="display:none">Belum ada VN favorit</div>
</div>

<!-- ABOUT -->
<div id="page-about" class="container">
  <h3>Tentang Aplikasi</h3>
  <p>Search engine Visual Novel berbasis data Angkringan Visual Novel.</p>
</div>

<div class="overlay" onclick="closeSheet()"></div>

<div class="sheet" id="sheet">
  <h3 id="sheetTitle"></h3>
  <div id="sheetGenre" class="genre"></div>
  <p id="sheetSum"></p>
  <span class="fav" onclick="toggleFav()">‚ù§Ô∏è</span>
  <iframe id="sheetFrame"></iframe>
</div>

<script>
let posts=[], currentLink="", currentTitle="", currentSum="", currentCats=[];
let favs=JSON.parse(localStorage.getItem("favs")||"[]");

// Load Feed
function loadFeed(d){posts=d.feed.entry||[];loadTags();renderHome();document.getElementById("splash").remove();}

// Load Tags
function loadTags(){const set=new Set();posts.forEach(p=>(p.category||[]).forEach(c=>set.add(c.term)));tagFilter.innerHTML='<option value="">Semua Genre</option>';[...set].sort().forEach(t=>tagFilter.innerHTML+=`<option>${t}</option>`);}

// Thumbnail
function getThumb(p){return p.media$thumbnail?.url||p.content?.$t.match(/img[^>]+src="([^"]+)"/)?.[1]||"https://via.placeholder.com/150";}

// Escape regex
function escapeRegex(s){return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');}

// Highlight
function highlight(text,key){if(!key) return text;const re=new RegExp(escapeRegex(key),'gi');return text.replace(re,m=>' <span class="highlight">'+m+'</span> ');}

// SEARCH
function searchVN(){
  const key=q.value.toLowerCase(), tag=tagFilter.value.toLowerCase();
  results.innerHTML="";let found=0;
  posts.forEach(p=>{
    const title=p.title.$t, sum=p.summary?.$t||"", cats=(p.category||[]).map(x=>x.term);
    const text=(title+sum+cats.join(" ")).toLowerCase();
    if((!key||text.includes(key)) && (!tag||cats.map(c=>c.toLowerCase()).includes(tag))){
      found++;
      const link=p.link.find(l=>l.rel==="alternate").href;
      results.innerHTML+=`<div class="item" onclick='openSheet(${JSON.stringify(title)},${JSON.stringify(sum)},${JSON.stringify(cats)},"${link}")'>
      <div class="thumb" style="background-image:url('${getThumb(p)}')"></div>
      <div>
      <div class="item-title">${highlight(title,key)}</div>
      <div class="preview">${highlight(sum.slice(0,90),key)}...</div>
      <div class="genre">${cats.join(", ")}</div>
      </div></div>`;
    }
  });
  empty.style.display=found?"none":"block";
}

// HOME
function renderHome(){
  const container=homeResults;container.innerHTML="";let top=posts.slice(0,10); // ambil top 10 VN
  if(top.length===0){emptyHome.style.display="block";return;}else{emptyHome.style.display="none";}
  top.forEach(p=>{
    const t=p.title.$t, s=p.summary?.$t||"", c=(p.category||[]).map(x=>x.term), l=p.link.find(l=>l.rel==="alternate").href;
    container.innerHTML+=`<div class="item" onclick='openSheet(${JSON.stringify(t)},${JSON.stringify(s)},${JSON.stringify(c)},"${l}")'>
    <div class="thumb" style="background-image:url('${getThumb(p)}')"></div>
    <div>
    <div class="item-title">${t}</div>
    <div class="preview">${s.slice(0,90)}...</div>
    <div class="genre">${c.join(", ")}</div>
    </div></div>`;
  });
}

// FAVORITES
function renderFav(){
  const container=favResults;container.innerHTML="";
  if(favs.length===0){emptyFav.style.display="block";return;}else{emptyFav.style.display="none";}
  favs.forEach(link=>{
    const p=posts.find(x=>x.link.find(l=>l.rel==="alternate").href===link);
    if(p){
      container.innerHTML+=`<div class="item" onclick='openSheet(${JSON.stringify(p.title.$t)},${JSON.stringify(p.summary?.$t||"")},${JSON.stringify((p.category||[]).map(x=>x.term))},"${link}")'>
      <div class="thumb" style="background-image:url('${getThumb(p)}')"></div>
      <div>
      <div class="item-title">${p.title.$t}</div>
      <div class="preview">${(p.summary?.$t||"").slice(0,90)}...</div>
      <div class="genre">${(p.category||[]).map(x=>x.term).join(", ")}</div>
      </div></div>`;
    }
  });
}

// OPEN / CLOSE SHEET
function openSheet(t,s,c,l){
  currentTitle=t;currentSum=s;currentCats=c;currentLink=l;
  sheetTitle.innerText=t;sheetSum.innerText=s;sheetGenre.innerText=c.join(", ");
  sheetFrame.src=l;updateFavIcon();
  sheet.classList.add("show");document.querySelector(".overlay").classList.add("show");
}
function closeSheet(){sheet.classList.remove("show");document.querySelector(".overlay").classList.remove("show");}

// FAVORITE TOGGLE
function toggleFav(){if(favs.includes(currentLink)) favs=favs.filter(x=>x!==currentLink);else favs.push(currentLink);localStorage.setItem("favs",JSON.stringify(favs));updateFavIcon();}
function updateFavIcon(){document.querySelector(".fav").innerText=favs.includes(currentLink)?"‚ù§Ô∏è":"ü§ç";}

// DARK MODE
function toggleDark(){document.body.classList.toggle("dark");}

// SWITCH TAB
function showTab(t){
  document.getElementById("page-home").style.display=t==="home"?"block":"none";
  document.getElementById("page-search").style.display=t==="search"?"block":"none";
  document.getElementById("page-fav").style.display=t==="fav"?"block":"none";
  document.getElementById("page-about").style.display=t==="about"?"block":"none";
  document.getElementById("tab-home").classList.toggle("active",t==="home");
  document.getElementById("tab-search").classList.toggle("active",t==="search");
  document.getElementById("tab-fav").classList.toggle("active",t==="fav");
  document.getElementById("tab-about").classList.toggle("active",t==="about");
  if(t==="fav") renderFav();
}

// SPLASH
setTimeout(()=>document.getElementById("splash").remove(),1500);
</script>

<script src="https://angkringanvisualnovel.blogspot.com/feeds/posts/default?alt=json&callback=loadFeed"></script>

</body>
</html>
