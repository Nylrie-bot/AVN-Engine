<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>VN Search Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,sans-serif;}
body{background:#fff;color:#202124;transition:background 0.3s,color 0.3s;overflow-x:hidden;}
body.dark{background:#121212;color:#eee;}
/* SPLASH */
#splash{position:fixed;inset:0;background:#4285f4;color:#fff;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:bold;z-index:999;}
/* HEADER */
.header{padding:14px;text-align:center;font-weight:bold;font-size:20px;display:flex;justify-content:center;align-items:center;gap:10px;position:relative;}
.toggle-dark{cursor:pointer;font-size:18px;position:absolute;right:10px;top:14px;}
/* HOME / SEARCH BAR */
#homeSearchBar, #searchBar{margin:20px auto;width:90%;max-width:500px;display:flex;gap:10px;position:relative;}
#homeSearchBar input, #searchBar input{flex:1;padding:12px 16px;border-radius:24px;border:1px solid #ccc;font-size:16px;transition:background 0.3s,color 0.3s;}
#homeSearchBar button, #searchBar button{padding:12px 16px;border:none;border-radius:24px;background:#4285f4;color:#fff;cursor:pointer;font-weight:bold;}
body.dark #homeSearchBar input,body.dark #searchBar input{background:#1f1f1f;color:#eee;border-color:#444;}
/* AUTOCOMPLETE */
.autocomplete-list{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #ddd;z-index:998;max-height:180px;overflow-y:auto;border-radius:8px;}
body.dark .autocomplete-list{background:#1f1f1f;border-color:#333;color:#eee;}
.suggestion-item{padding:8px;cursor:pointer;border-bottom:1px solid #ddd;}
body.dark .suggestion-item{border-color:#333;}
.suggestion-item:hover{background:#4285f4;color:#fff;}
/* CONTAINER */
.container{padding:15px;padding-bottom:80px;display:none;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px;}
.item{display:flex;flex-direction:column;gap:8px;background:#f1f3f4;padding:8px;border-radius:12px;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;}
body.dark .item{background:#1f1f1f;}
.item:hover{transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,.2);}
.thumb{width:100%;height:180px;border-radius:10px;background-size:cover;background-position:center;}
.item-title{font-weight:bold;font-size:14px;}
.preview{font-size:12px;opacity:.8;}
.genre{font-size:11px;opacity:.6;}
.highlight{background:yellow;color:#000;}
.empty{opacity:.6;text-align:center;margin-top:20px;}
/* OVERLAY + SHEET */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;z-index:998;}
.overlay.show{display:block;}
.sheet{position:fixed;left:0;right:0;bottom:-100%;background:#fff;border-radius:20px 20px 0 0;padding:10px;transition:.3s;max-height:90%;overflow:auto;z-index:999;}
body.dark .sheet{background:#1f1f1f;color:#eee;}
.sheet.show{bottom:0;}
.sheet iframe{width:100%;height:70vh;border:none;border-radius:12px;}
.fav{font-size:20px;float:right;cursor:pointer;user-select:none;}
/* FLOATING NAV */
.floating-nav{position:fixed;right:15px;bottom:15px;display:flex;flex-direction:column;gap:10px;z-index:999;}
.floating-nav button{padding:12px;border:none;border-radius:50%;background:#4285f4;color:#fff;cursor:pointer;font-size:16px;box-shadow:0 2px 6px rgba(0,0,0,.2);}
/* OVERLAY MENU */
.overlay-menu{
  position:fixed;
  top:0;
  right:0;
  width:250px;
  height:100%;
  background:#fff;
  transform:translateX(100%);
  transition:transform 0.3s ease;
  z-index:1000;
  padding:20px;
  overflow-y:auto;
}
body.dark .overlay-menu{background:#1f1f1f;color:#eee;}
.overlay-menu.show{transform:translateX(0);}
.overlay-menu button{display:block;margin:10px 0;padding:10px;width:100%;border:none;border-radius:8px;background:#4285f4;color:#fff;cursor:pointer;font-weight:bold;}
</style>
</head>
<body>

<div id="splash">VN Search Pro</div>

<div class="header">
  VN Search
  <div class="toggle-dark" onclick="toggleDark()">üåô</div>
</div>

<!-- HOME -->
<div id="page-home" class="container" style="display:block">
  <div id="homeSearchBar">
    <input id="homeInput" placeholder="Cari judul / genre / kata kunci..." oninput="showSuggestions(this,homeSuggestions)">
    <button onclick="doHomeSearch()">Search</button>
    <div id="homeSuggestions" class="autocomplete-list"></div>
  </div>
  <div id="homeResults" class="grid"></div>
  <div id="emptyHome" class="empty">Belum ada rekomendasi</div>
</div>

<!-- SEARCH -->
<div id="page-search" class="container">
  <div id="searchBar">
    <input id="q" placeholder="Cari judul, genre, kata kunci..." oninput="showSuggestions(this,searchSuggestions)">
    <button onclick="searchVN()">Search</button>
    <div id="searchSuggestions" class="autocomplete-list"></div>
  </div>
  <select id="tagFilter" onchange="searchVN()"><option value="">Semua Genre</option></select>
  <div id="results" class="grid"></div>
  <div id="empty" class="empty">Tidak ada hasil</div>
</div>

<!-- FAVORITES -->
<div id="page-fav" class="container">
  <div id="favResults" class="grid"></div>
  <div id="emptyFav" class="empty">Belum ada VN favorit</div>
</div>

<!-- ABOUT -->
<div id="page-about" class="container">
  <h3>Tentang Aplikasi</h3>
  <p>Search engine Visual Novel berbasis data Angkringan Visual Novel.</p>
</div>

<!-- OVERLAY + SHEET -->
<div class="overlay" onclick="closeSheet()"></div>

<div class="sheet" id="sheet">
  <h3 id="sheetTitle"></h3>
  <div id="sheetGenre" class="genre"></div>
  <p id="sheetSum"></p>
  <span class="fav" onclick="toggleFav()">‚ù§Ô∏è</span>
  <iframe id="sheetFrame"></iframe>
</div>

<!-- FLOATING NAV -->
<div class="floating-nav">
  <button onclick="showTab('home')">üè†</button>
  <button onclick="showTab('search')">üîç</button>
  <button onclick="showTab('fav')">‚ù§Ô∏è</button>
  <button onclick="toggleOverlayMenu()">‚ò∞</button>
</div>

<!-- OVERLAY MENU -->
<div class="overlay-menu" id="overlayMenu">
  <button onclick="toggleDark()">Dark Mode üåô</button>
  <button onclick="showTab('home')">Home üè†</button>
  <button onclick="showTab('search')">Search üîç</button>
  <button onclick="showTab('fav')">Favorites ‚ù§Ô∏è</button>
  <button onclick="showTab('about')">About ‚ÑπÔ∏è</button>
  <button onclick="toggleOverlayMenu()">Close ‚úñÔ∏è</button>
</div>

<script>
let posts=[], currentLink="", currentTitle="", currentSum="", currentCats=[];
let favs=JSON.parse(localStorage.getItem("favs")||"[]");
let suggestions=[], searchOffset=0, searchLimit=20, lastKey="";

// -------------------- DATA FEED --------------------
function loadFeed(d){
    posts=d.feed.entry||[];
    loadTags();
    buildSuggestions();
    renderHome();
    document.getElementById("splash").remove();
}
function loadTags(){
    const set=new Set();
    posts.forEach(p=>(p.category||[]).forEach(c=>set.add(c.term)));
    tagFilter.innerHTML='<option value="">Semua Genre</option>';
    [...set].sort().forEach(t=>tagFilter.innerHTML+=`<option>${t}</option>`);
}
function getThumb(p){return p.media$thumbnail?.url||p.content?.$t.match(/img[^>]+src="([^"]+)"/)?.[1]||"https://via.placeholder.com/150";}

// -------------------- AUTOCOMPLETE --------------------
function buildSuggestions(){suggestions=posts.map(p=>p.title.$t);}
function showSuggestions(inputEl,listEl){
    const key=inputEl.value.toLowerCase();
    listEl.innerHTML="";
    if(!key) return;
    suggestions.filter(t=>t.toLowerCase().includes(key)).slice(0,5).forEach(t=>{
        const div=document.createElement("div");
        div.textContent=t;div.className="suggestion-item";
        div.onclick=()=>{inputEl.value=t;searchVN();listEl.innerHTML="";};
        listEl.appendChild(div);
    });
}

// -------------------- SEARCH --------------------
function doHomeSearch(){const key=homeInput.value;showTab('search');q.value=key;searchVN(key);}
function searchVN(keyInput){
    const key=keyInput||q.value.toLowerCase();
    const tag=tagFilter.value.toLowerCase();
    results.innerHTML="";empty.style.display="none";searchOffset=0;lastKey=key;
    loadMoreResults();
}
function loadMoreResults(){
    const tag=tagFilter.value.toLowerCase();let count=0;
    for(let i=searchOffset;i<posts.length;i++){
        const p=posts[i];const title=p.title.$t;const sum=p.summary?.$t||"";const cats=(p.category||[]).map(x=>x.term);
        const text=(title+sum+cats.join(" ")).toLowerCase();
        if((!lastKey||text.includes(lastKey))&&(!tag||cats.map(c=>c.toLowerCase()).includes(tag))){
            results.innerHTML+=`<div class="item" onclick='openSheet(${JSON.stringify(title)},${JSON.stringify(sum)},${JSON.stringify(cats)},"${p.link.find(l=>l.rel==="alternate").href}")'>
            <div class="thumb" style="background-image:url('${getThumb(p)}')"></div>
            <div>
            <div class="item-title">${title}</div>
            <div class="preview">${sum.slice(0,90)}...</div>
            <div class="genre">${cats.join(", ")}</div>
            </div></div>`;
            count++;
        }
        if(count>=searchLimit){searchOffset=i+1;return;}
    }
    if(count===0) empty.style.display="block";
}
results.addEventListener("scroll",()=>{if(results.scrollTop+results.clientHeight>=results.scrollHeight-50) loadMoreResults();});

// -------------------- HOME --------------------
function renderHome(){
    const container=homeResults;container.innerHTML="";
    let top=posts.slice(0,10);if(top.length===0){emptyHome.style.display="block";return;}else{emptyHome.style.display="none";}
    top.forEach(p=>{
        const t=p.title.$t,s=p.summary?.$t||"",c=(p.category||[]).map(x=>x.term),l=p.link.find(l=>l.rel==="alternate").href;
        container.innerHTML+=`<div class="item" onclick='openSheet(${JSON.stringify(t)},${JSON.stringify(s)},${JSON.stringify(c)},"${l}")'>
        <div class="thumb" style="background-image:url('${getThumb(p)}')"></div>
        <div><div class="item-title">${t}</div><div class="preview">${s.slice(0,90)}...</div><div class="genre">${c.join(", ")}</div></div></div>`;
    });
}

// -------------------- FAVORITES --------------------
function renderFav(){const container=favResults;container.innerHTML="";if(favs.length===0){emptyFav.style.display="block";return;}else{emptyFav.style.display="none";}
favs.forEach(link=>{const p=posts.find(x=>x.link.find(l=>l.rel==="alternate").href===link);if(p){container.innerHTML+=`<div class="item" onclick='openSheet(${JSON.stringify(p.title.$t)},${JSON.stringify(p.summary?.$t||"")},${JSON.stringify((p.category||[]).map(x=>x.term))},"${link}")'>
<div class="thumb" style="background-image:url('${getThumb(p)}')"></div>
<div><div class="item-title">${p.title.$t}</div><div class="preview">${(p.summary?.$t||"").slice(0,90)}...</div><div class="genre">${(p.category||[]).map(x=>x.term).join(", ")}</div></div></div>`;}});}
function openSheet(t,s,c,l){currentTitle=t;currentSum=s;currentCats=c;currentLink=l;
sheetTitle.innerText=t;sheetSum.innerText=s;sheetGenre.innerText=c.join(", ");
sheetFrame.src=l;updateFavIcon();sheet.classList.add("show");document.querySelector(".overlay").classList.add("show");}
function closeSheet(){sheet.classList.remove("show");document.querySelector(".overlay").classList.remove("show");}
function toggleFav(){if(favs.includes(currentLink)) favs=favs.filter(x=>x!==currentLink);else favs.push(currentLink);localStorage.setItem("favs",JSON.stringify(favs));updateFavIcon();}
function updateFavIcon(){document.querySelector(".fav").innerText=favs.includes(currentLink)?"‚ù§Ô∏è":"ü§ç";}
function toggleDark(){document.body.classList.toggle("dark");}
function showTab(t){document.getElementById("page-home").style.display=t==="home"?"block":"none";
document.getElementById("page-search").style.display=t==="search"?"block":"none";
document.getElementById("page-fav").style.display=t==="fav"?"block":"none";
document.getElementById("page-about").style.display=t==="about"?"block":"none";
if(t==="fav") renderFav();closeOverlayMenu();}
function toggleOverlayMenu(){document.getElementById("overlayMenu").classList.toggle("show");}
function closeOverlayMenu(){document.getElementById("overlayMenu").classList.remove("show");}

/* SPLASH */
setTimeout(()=>document.getElementById("splash").remove(),1500);
</script>

<script src="https://angkringanvisualnovel.blogspot.com/feeds/posts/default?alt=json&callback=loadFeed"></script>

</body>
</html>
