<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Angkringan Visual Novel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* --- Styles sama seperti versi final sebelumnya --- */
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,sans-serif;}
body{background:#fff;color:#202124;transition:background 0.3s,color 0.3s;overflow-x:hidden;}
body.dark{background:#121212;color:#eee;}
/* Tambahkan style sheet, header, container, grid, item, overlay, floating nav, toast, dll */
/* ... kode CSS sama seperti versi final sebelumnya ... */
</style>
</head>
<body>

<div id="splash">Angkringan Visual Novel</div>

<div class="header">
  Angkringan Visual Novel
  <div class="toggle-dark" onclick="toggleDark()">ğŸŒ™</div>
</div>

<div id="page-home" class="container show">
  <div id="homeSearchBar">
    <input id="homeInput" placeholder="Cari judul / genre / kata kunci..." oninput="showSuggestions(this,homeSuggestions)">
    <button onclick="doHomeSearch()">Search</button>
    <div id="homeSuggestions" class="autocomplete-list"></div>
  </div>
  <div id="homeResults" class="grid"></div>
  <div id="emptyHome" class="empty">Belum ada rekomendasi</div>
</div>

<div id="page-search" class="container">
  <div id="searchBar">
    <input id="q" placeholder="Cari judul, genre, kata kunci..." oninput="lastKey=this.value;searchOffset=0;displayedLinks.clear();results.innerHTML='';loadMoreResults();">
  </div>
  <select id="tagFilter" onchange="searchOffset=0;displayedLinks.clear();results.innerHTML='';loadMoreResults();"><option value="">Semua Genre</option></select>
  <div id="results" class="grid"></div>
  <div id="empty" class="empty">Tidak ada hasil</div>
</div>

<div id="page-fav" class="container">
  <div id="favResults" class="grid"></div>
  <div id="emptyFav" class="empty">Belum ada VN favorit</div>
</div>

<div id="page-about" class="container">
  <h3>Tentang Aplikasi</h3>
  <p>Search engine Visual Novel berbasis data Angkringan Visual Novel.</p>
</div>

<div class="overlay" onclick="closeSheet()"></div>

<div class="sheet" id="sheet">
  <h3 id="sheetTitle"></h3>
  <div id="sheetGenre" class="genre"></div>
  <p id="sheetSum"></p>
  <span class="fav" onclick="toggleFav()">â¤ï¸</span>
  <iframe id="sheetFrame"></iframe>
</div>

<div class="floating-nav">
  <button onclick="showTab('home')">ğŸ </button>
  <button onclick="showTab('search')">ğŸ”</button>
  <button onclick="showTab('fav')">â¤ï¸</button>
  <button onclick="toggleOverlayMenu()">â˜°</button>
</div>

<div class="overlay-menu" id="overlayMenu">
  <button onclick="showTab('home')">Home ğŸ </button>
  <button onclick="showTab('search')">Search ğŸ”</button>
  <button onclick="showTab('fav')">Favorites â¤ï¸</button>
  <button onclick="showTab('about')">About â„¹ï¸</button>
  <button onclick="toggleOverlayMenu()">Close âœ–ï¸</button>
</div>

<div class="toast" id="toast">VN Baru Tersedia!</div>

<script>
// --- Script sama seperti versi final sebelumnya ---
// Variabel global
let posts=[], currentLink="", currentTitle="", currentSum="", currentCats=[];
let favs=JSON.parse(localStorage.getItem("favs")||"[]");
let lastKey="", searchOffset=0, searchLimit=20, lastVNLinks=JSON.parse(localStorage.getItem("vnLinks")||"[]");
let displayedLinks = new Set();

// Splash
setTimeout(()=>document.getElementById("splash").remove(),1500);

// Dark mode
function toggleDark(){document.body.classList.toggle("dark");}

// Tabs
function showTab(t){ /* ... sama seperti versi sebelumnya ... */ }

// Overlay menu
function toggleOverlayMenu(){document.getElementById("overlayMenu").classList.toggle("show");}
function closeOverlayMenu(){document.getElementById("overlayMenu").classList.remove("show");}

// Sheet
function openSheet(t,s,c,l){
  currentTitle=t;currentSum=s;currentCats=c;currentLink=l;
  sheetTitle.innerText=t;sheetSum.innerText=s;sheetGenre.innerText=c.join(", ");
  sheetFrame.src=l;updateFavIcon();
  sheet.classList.add("show");document.querySelector(".overlay").classList.add("show");
}
function closeSheet(){sheet.classList.remove("show");document.querySelector(".overlay").classList.remove("show");}
function toggleFav(){/* ... */}

// Fetch feed, checkNewVN, showToast, loadTags, buildSuggestions, showSuggestions, doHomeSearch, loadMoreResults
// --- sama seperti versi final sebelumnya ---

// Infinite scroll
window.addEventListener('scroll', () => {
  if((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 150){
    if(searchOffset < posts.length) loadMoreResults();
  }
});

// Tangani tombol back di Android
window.addEventListener('popstate', function(event) {
  if(sheet.classList.contains('show')){
    closeSheet(); // Tutup sheet dulu
    history.pushState(null, null, location.href); // Cegah back keluar
  }
});
// Push state awal agar back bisa di-handle
history.pushState(null, null, location.href);

// Fetch feed
function loadFeed(d){ /* ... sama seperti versi final sebelumnya ... */ }
function fetchFeed(){ /* ... */ }
fetchFeed();

// Helper
function getThumb(p){ /* ... sama seperti versi final sebelumnya ... */ }

</script>

<script src="https://angkringanvisualnovel.blogspot.com/feeds/posts/default?alt=json&callback=loadFeed"></script>

</body>
</html>
